{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport { createContext, memo, forwardRef, useContext, useImperativeHandle, createElement, useState, useEffect, useRef } from 'react';\nimport { Controller, a, config } from '@react-spring/web';\nimport { useMemoOne } from 'use-memo-one';\nimport { frameLoop } from '@react-spring/shared/globals';\nimport { useOnce } from '@react-spring/shared';\nconst ParentContext = createContext(null);\n\nfunction getScrollType(horizontal) {\n  return horizontal ? 'scrollLeft' : 'scrollTop';\n}\n\nconst START_TRANSLATE_3D = 'translate3d(0px,0px,0px)';\nconst START_TRANSLATE = 'translate(0px,0px)';\nconst ParallaxLayer = memo(forwardRef((_ref, ref) => {\n  let {\n    horizontal,\n    factor = 1,\n    offset = 0,\n    speed = 0\n  } = _ref,\n      rest = _objectWithoutPropertiesLoose(_ref, [\"horizontal\", \"factor\", \"offset\", \"speed\"]); // Our parent controls our height and position.\n\n\n  const parent = useContext(ParentContext); // This is how we animate.\n\n  const ctrl = useMemoOne(() => {\n    const targetScroll = Math.floor(offset) * parent.space;\n    const distance = parent.space * offset + targetScroll * speed;\n    return new Controller({\n      space: parent.space * factor,\n      translate: -(parent.current * speed) + distance\n    });\n  }, []); // Create the layer.\n\n  const layer = useMemoOne(() => ({\n    setPosition(height, scrollTop, immediate = false) {\n      const targetScroll = Math.floor(offset) * height;\n      const distance = height * offset + targetScroll * speed;\n      ctrl.start({\n        translate: -(scrollTop * speed) + distance,\n        config: parent.config,\n        immediate\n      });\n    },\n\n    setHeight(height, immediate = false) {\n      ctrl.start({\n        space: height * factor,\n        config: parent.config,\n        immediate\n      });\n    }\n\n  }), []);\n  useImperativeHandle(ref, () => layer); // Register the layer with our parent.\n\n  useOnce(() => {\n    if (parent) {\n      parent.layers.add(layer);\n      parent.update();\n      return () => {\n        parent.layers.delete(layer);\n        parent.update();\n      };\n    }\n  });\n  const translate3d = ctrl.springs.translate.to(horizontal ? x => \"translate3d(\" + x + \"px,0,0)\" : y => \"translate3d(0,\" + y + \"px,0)\");\n  return /*#__PURE__*/createElement(a.div, _extends({}, rest, {\n    style: _extends({\n      position: 'absolute',\n      backgroundSize: 'auto',\n      backgroundRepeat: 'no-repeat',\n      willChange: 'transform',\n      [horizontal ? 'height' : 'width']: '100%',\n      [horizontal ? 'width' : 'height']: ctrl.springs.space,\n      WebkitTransform: translate3d,\n      msTransform: translate3d,\n      transform: translate3d\n    }, rest.style)\n  }));\n}));\nconst Parallax = memo(forwardRef((props, ref) => {\n  const [ready, setReady] = useState(false);\n\n  const {\n    pages,\n    config: config$1 = config.slow,\n    enabled = true,\n    horizontal = false\n  } = props,\n        rest = _objectWithoutPropertiesLoose(props, [\"pages\", \"innerStyle\", \"config\", \"enabled\", \"horizontal\"]);\n\n  const state = useMemoOne(() => ({\n    config: config$1,\n    busy: false,\n    space: 0,\n    current: 0,\n    offset: 0,\n    controller: new Controller({\n      scroll: 0\n    }),\n    layers: new Set(),\n    update: function (_update) {\n      function update() {\n        return _update.apply(this, arguments);\n      }\n\n      update.toString = function () {\n        return _update.toString();\n      };\n\n      return update;\n    }(() => update()),\n    scrollTo: function (_scrollTo) {\n      function scrollTo(_x) {\n        return _scrollTo.apply(this, arguments);\n      }\n\n      scrollTo.toString = function () {\n        return _scrollTo.toString();\n      };\n\n      return scrollTo;\n    }(offset => scrollTo(offset)),\n    stop: () => state.controller.stop()\n  }), []);\n  useEffect(() => {\n    state.config = config$1;\n  }, [config$1]);\n  useImperativeHandle(ref, () => state);\n  const containerRef = useRef();\n  const contentRef = useRef();\n\n  const update = () => {\n    const container = containerRef.current;\n    if (!container) return;\n    const spaceProp = horizontal ? 'clientWidth' : 'clientHeight';\n    state.space = container[spaceProp];\n    const scrollType = getScrollType(horizontal);\n\n    if (enabled) {\n      state.current = container[scrollType];\n    } else {\n      container[scrollType] = state.current = state.offset * state.space;\n    }\n\n    const content = contentRef.current;\n\n    if (content) {\n      const sizeProp = horizontal ? 'width' : 'height';\n      content.style[sizeProp] = state.space * pages + \"px\";\n    }\n\n    state.layers.forEach(layer => {\n      layer.setHeight(state.space, true);\n      layer.setPosition(state.space, state.current, true);\n    });\n  };\n\n  const scrollTo = offset => {\n    const container = containerRef.current;\n    const scrollType = getScrollType(horizontal);\n    state.offset = offset;\n    state.controller.stop().start({\n      scroll: offset * state.space,\n      config: config$1,\n\n      onChange({\n        scroll\n      }) {\n        container[scrollType] = scroll;\n      }\n\n    });\n  };\n\n  const onScroll = event => {\n    if (!state.busy) {\n      state.busy = true;\n      state.current = event.target[getScrollType(horizontal)];\n      frameLoop.onFrame(() => {\n        state.layers.forEach(layer => layer.setPosition(state.space, state.current));\n        state.busy = false;\n      });\n    }\n  };\n\n  useEffect(() => state.update());\n  useOnce(() => {\n    setReady(true);\n\n    const onResize = () => {\n      const update = () => state.update();\n\n      frameLoop.onFrame(update);\n      setTimeout(update, 150); // Some browsers don't fire on maximize!\n    };\n\n    window.addEventListener('resize', onResize, false);\n    return () => window.removeEventListener('resize', onResize, false);\n  });\n  const overflow = enabled ? 'scroll' : 'hidden';\n  return /*#__PURE__*/createElement(a.div, _extends({}, rest, {\n    ref: containerRef,\n    onScroll: onScroll,\n    onWheel: enabled ? state.stop : undefined,\n    onTouchStart: enabled ? state.stop : undefined,\n    style: _extends({\n      position: 'absolute',\n      width: '100%',\n      height: '100%',\n      overflow,\n      overflowY: horizontal ? 'hidden' : overflow,\n      overflowX: horizontal ? overflow : 'hidden',\n      WebkitOverflowScrolling: 'touch',\n      WebkitTransform: START_TRANSLATE,\n      msTransform: START_TRANSLATE,\n      transform: START_TRANSLATE_3D\n    }, rest.style)\n  }), ready && /*#__PURE__*/createElement(a.div, {\n    ref: contentRef,\n    style: _extends({\n      overflow: 'hidden',\n      position: 'absolute',\n      [horizontal ? 'height' : 'width']: '100%',\n      [horizontal ? 'width' : 'height']: state.space * pages,\n      WebkitTransform: START_TRANSLATE,\n      msTransform: START_TRANSLATE,\n      transform: START_TRANSLATE_3D\n    }, props.innerStyle)\n  }, /*#__PURE__*/createElement(ParentContext.Provider, {\n    value: state\n  }, rest.children)));\n}));\nexport { Parallax, ParallaxLayer };","map":{"version":3,"sources":["src/index.tsx"],"names":["ParentContext","React","horizontal","START_TRANSLATE_3D","START_TRANSLATE","ParallaxLayer","factor","offset","speed","rest","parent","useContext","ctrl","useMemoOne","targetScroll","Math","distance","space","translate","layer","setPosition","immediate","height","scrollTop","config","setHeight","useOnce","translate3d","x","y","position","backgroundSize","backgroundRepeat","willChange","WebkitTransform","msTransform","transform","Parallax","useState","configs","enabled","state","busy","current","controller","scroll","layers","update","scrollTo","stop","useEffect","containerRef","useRef","contentRef","container","spaceProp","scrollType","getScrollType","content","sizeProp","onChange","onScroll","event","frameLoop","setReady","onResize","setTimeout","window","overflow","width","overflowY","overflowX","WebkitOverflowScrolling","ready","props"],"mappings":";;;;;;;AAYA,MAAMA,aAAa,GAAGC,aAAAA,CAAtB,IAAsBA,CAAtB;;AAEA,SAAA,aAAA,CAAA,UAAA,EAA4C;AAC1C,SAAOC,UAAU,GAAA,YAAA,GAAjB,WAAA;AACD;;AAED,MAAMC,kBAAkB,GAAxB,0BAAA;AACA,MAAMC,eAAe,GAArB,oBAAA;MAgCaC,aAAa,GAAG,IAAA,CAC3B,UAAA,CACE,CAAA,IAAA,EAAA,GAAA,KAAqE;AAAA,MAApE;AAAA,IAAA,UAAA;AAAcC,IAAAA,MAAM,GAApB,CAAA;AAA0BC,IAAAA,MAAM,GAAhC,CAAA;AAAsCC,IAAAA,KAAK,GAAG;AAA9C,MAAoE,IAAA;AAAA,MAAhBC,IAAgB,GAAA,6BAAA,CAAA,IAAA,EAAA,CAAA,YAAA,EAAA,QAAA,EAAA,QAAA,EAAA,OAAA,CAAA,CAAA,CAAA,CACnE;;;AACA,QAAMC,MAAM,GAAGC,UAAU,CAF0C,aAE1C,CAAzB,CAFmE,CAAA;;AAKnE,QAAMC,IAAI,GAAGC,UAAU,CAAC,MAAM;AAC5B,UAAMC,YAAY,GAAGC,IAAI,CAAJA,KAAAA,CAAAA,MAAAA,IAAqBL,MAAM,CAAhD,KAAA;AACA,UAAMM,QAAQ,GAAGN,MAAM,CAANA,KAAAA,GAAAA,MAAAA,GAAwBI,YAAY,GAArD,KAAA;AAEA,WAAO,IAAA,UAAA,CAAyB;AAC9BG,MAAAA,KAAK,EAAEP,MAAM,CAANA,KAAAA,GADuB,MAAA;AAE9BQ,MAAAA,SAAS,EAAE,EAAER,MAAM,CAANA,OAAAA,GAAF,KAAA,IAA4BM;AAFT,KAAzB,CAAP;AAJqB,GAAA,EAL4C,EAK5C,CAAvB,CALmE,CAAA;;AAgBnE,QAAMG,KAAK,GAAGN,UAAU,CACtB,OAAO;AACLO,IAAAA,WAAW,CAAA,MAAA,EAAA,SAAA,EAAoBC,SAAS,GAA7B,KAAA,EAAuC;AAChD,YAAMP,YAAY,GAAGC,IAAI,CAAJA,KAAAA,CAAAA,MAAAA,IAArB,MAAA;AACA,YAAMC,QAAQ,GAAGM,MAAM,GAANA,MAAAA,GAAkBR,YAAY,GAA/C,KAAA;AACAF,MAAAA,IAAI,CAAJA,KAAAA,CAAW;AACTM,QAAAA,SAAS,EAAE,EAAEK,SAAS,GAAX,KAAA,IADF,QAAA;AAETC,QAAAA,MAAM,EAAEd,MAAM,CAFL,MAAA;AAGTW,QAAAA;AAHS,OAAXT;AAJG,KAAA;;AAULa,IAAAA,SAAS,CAAA,MAAA,EAASJ,SAAS,GAAlB,KAAA,EAA4B;AACnCT,MAAAA,IAAI,CAAJA,KAAAA,CAAW;AACTK,QAAAA,KAAK,EAAEK,MAAM,GADJ,MAAA;AAETE,QAAAA,MAAM,EAAEd,MAAM,CAFL,MAAA;AAGTW,QAAAA;AAHS,OAAXT;AAKD;;AAhBI,GAAP,CADsB,EAAxB,EAAwB,CAAxB;AAsBAX,EAAAA,mBAAAA,CAAAA,GAAAA,EAA+B,MAtCoC,KAsCnEA,CAAAA,CAtCmE,CAAA;;AAyCnEyB,EAAAA,OAAO,CAAC,MAAM;AACZ,QAAA,MAAA,EAAY;AACVhB,MAAAA,MAAM,CAANA,MAAAA,CAAAA,GAAAA,CAAAA,KAAAA;AACAA,MAAAA,MAAM,CAANA,MAAAA;AACA,aAAO,MAAM;AACXA,QAAAA,MAAM,CAANA,MAAAA,CAAAA,MAAAA,CAAAA,KAAAA;AACAA,QAAAA,MAAM,CAANA,MAAAA;AAFF,OAAA;AAID;AARHgB,GAAO,CAAPA;AAWA,QAAMC,WAAW,GAAGf,IAAI,CAAJA,OAAAA,CAAAA,SAAAA,CAAAA,EAAAA,CAClBV,UAAU,GACN0B,CAAC,IAAA,iBAAA,CAAA,GADK,SAAA,GAENC,CAAC,IAAA,mBAAA,CAAA,GAHP,OAAoBjB,CAApB;AAMA,SAAA,aACE,aAAA,CAAC,CAAD,CAAA,GAAA,EAAA,QAAA,CAAA,EAAA,EAAA,IAAA,EAAA;AAEE,IAAA,KAAK,EAAA,QAAA,CAAA;AACHkB,MAAAA,QAAQ,EADL,UAAA;AAEHC,MAAAA,cAAc,EAFX,MAAA;AAGHC,MAAAA,gBAAgB,EAHb,WAAA;AAIHC,MAAAA,UAAU,EAJP,WAAA;AAKH,OAAC/B,UAAU,GAAA,QAAA,GAAX,OAAA,GALG,MAAA;AAMH,OAACA,UAAU,GAAA,OAAA,GAAX,QAAA,GAAmCU,IAAI,CAAJA,OAAAA,CANhC,KAAA;AAOHsB,MAAAA,eAAe,EAPZ,WAAA;AAQHC,MAAAA,WAAW,EARR,WAAA;AASHC,MAAAA,SAAS,EAAET;AATR,KAAA,EAUAlB,IAAI,CAVJ,KAAA;AAFP,GAAA,CAAA,CADF;AA5DuB,CAC3B,CAD2B,C;MA6FhB4B,QAAQ,GAAG,IAAA,CACtB,UAAA,CAA2C,CAAA,KAAA,EAAA,GAAA,KAAgB;AACzD,QAAM,CAAA,KAAA,EAAA,QAAA,IAAoBC,QAAQ,CAAlC,KAAkC,CAAlC;;AACA,QAAM;AAAA,IAAA,KAAA;AAGJd,IAAAA,MAAAA,EAAAA,QAAM,GAAGe,MAAO,CAHZ,IAAA;AAIJC,IAAAA,OAAO,GAJH,IAAA;AAKJtC,IAAAA,UAAU,GAAG;AALT,MAAN,KAAA;AAAA,QAMKO,IANL,GAAA,6BAAA,CAAA,KAAA,EAAA,CAAA,OAAA,EAAA,YAAA,EAAA,QAAA,EAAA,SAAA,EAAA,YAAA,CAAA,CAAA;;AASA,QAAMgC,KAAgB,GAAG5B,UAAU,CACjC,OAAO;AACLW,IAAAA,MAAAA,EADK,QAAA;AAELkB,IAAAA,IAAI,EAFC,KAAA;AAGLzB,IAAAA,KAAK,EAHA,CAAA;AAIL0B,IAAAA,OAAO,EAJF,CAAA;AAKLpC,IAAAA,MAAM,EALD,CAAA;AAMLqC,IAAAA,UAAU,EAAE,IAAA,UAAA,CAAe;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAAf,CANP;AAOLC,IAAAA,MAAM,EAAE,IAPH,GAOG,EAPH;AAQLC,IAAAA,MAAM,EAAA,UAAA,OAAA,EAAA;AAAA,eAAA,MAAA,GAAA;AAAA,eAAA,OAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA;AAAA;;AAAA,MAAA,MAAA,CAAA,QAAA,GAAA,YAAA;AAAA,eAAA,OAAA,CAAA,QAAA,EAAA;AAAA,OAAA;;AAAA,aAAA,MAAA;AAAA,KAAA,CAAE,MAAMA,MART,EAQC,CARD;AASLC,IAAAA,QAAQ,EAAA,UAAA,SAAA,EAAA;AAAA,eAAA,QAAA,CAAA,EAAA,EAAA;AAAA,eAAA,SAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA;AAAA;;AAAA,MAAA,QAAA,CAAA,QAAA,GAAA,YAAA;AAAA,eAAA,SAAA,CAAA,QAAA,EAAA;AAAA,OAAA;;AAAA,aAAA,QAAA;AAAA,KAAA,CAAEzC,MAAM,IAAIyC,QAAQ,CATvB,MASuB,CAApB,CATH;AAULC,IAAAA,IAAI,EAAE,MAAMR,KAAK,CAALA,UAAAA,CAAAA,IAAAA;AAVP,GAAP,CADiC,EAAnC,EAAmC,CAAnC;AAgBAS,EAAAA,SAAS,CAAC,MAAM;AACdT,IAAAA,KAAK,CAALA,MAAAA,GAAAA,QAAAA;AADO,GAAA,EAEN,CAFHS,QAEG,CAFM,CAATA;AAIAjD,EAAAA,mBAAAA,CAAAA,GAAAA,EAA+B,MAA/BA,KAAAA,CAAAA;AAEA,QAAMkD,YAAY,GAAGC,MAArB,EAAA;AACA,QAAMC,UAAU,GAAGD,MAAnB,EAAA;;AAEA,QAAML,MAAM,GAAG,MAAM;AACnB,UAAMO,SAAS,GAAGH,YAAY,CAA9B,OAAA;AACA,QAAI,CAAJ,SAAA,EAAgB;AAEhB,UAAMI,SAAS,GAAGrD,UAAU,GAAA,aAAA,GAA5B,cAAA;AACAuC,IAAAA,KAAK,CAALA,KAAAA,GAAca,SAAS,CAAvBb,SAAuB,CAAvBA;AAEA,UAAMe,UAAU,GAAGC,aAAa,CAAhC,UAAgC,CAAhC;;AACA,QAAA,OAAA,EAAa;AACXhB,MAAAA,KAAK,CAALA,OAAAA,GAAgBa,SAAS,CAAzBb,UAAyB,CAAzBA;AADF,KAAA,MAEO;AACLa,MAAAA,SAAS,CAATA,UAAS,CAATA,GAAwBb,KAAK,CAALA,OAAAA,GAAgBA,KAAK,CAALA,MAAAA,GAAeA,KAAK,CAA5Da,KAAAA;AACD;;AAED,UAAMI,OAAO,GAAGL,UAAU,CAA1B,OAAA;;AACA,QAAA,OAAA,EAAa;AACX,YAAMM,QAAQ,GAAGzD,UAAU,GAAA,OAAA,GAA3B,QAAA;AACAwD,MAAAA,OAAO,CAAPA,KAAAA,CAAAA,QAAAA,IAA6BjB,KAAK,CAALA,KAAAA,GAA7BiB,KAA6BjB,GAA7BiB,IAAAA;AACD;;AAEDjB,IAAAA,KAAK,CAALA,MAAAA,CAAAA,OAAAA,CAAqBtB,KAAK,IAAI;AAC5BA,MAAAA,KAAK,CAALA,SAAAA,CAAgBsB,KAAK,CAArBtB,KAAAA,EAAAA,IAAAA;AACAA,MAAAA,KAAK,CAALA,WAAAA,CAAkBsB,KAAK,CAAvBtB,KAAAA,EAA+BsB,KAAK,CAApCtB,OAAAA,EAAAA,IAAAA;AAFFsB,KAAAA;AApBF,GAAA;;AA0BA,QAAMO,QAAQ,GAAIzC,MAAD,IAAoB;AACnC,UAAM+C,SAAS,GAAGH,YAAY,CAA9B,OAAA;AACA,UAAMK,UAAU,GAAGC,aAAa,CAAhC,UAAgC,CAAhC;AAEAhB,IAAAA,KAAK,CAALA,MAAAA,GAAAA,MAAAA;AACAA,IAAAA,KAAK,CAALA,UAAAA,CAAAA,IAAAA,GAAAA,KAAAA,CAA8B;AAC5BI,MAAAA,MAAM,EAAEtC,MAAM,GAAGkC,KAAK,CADM,KAAA;AAE5BjB,MAAAA,MAAAA,EAF4B,QAAA;;AAG5BoC,MAAAA,QAAQ,CAAC;AAAEf,QAAAA;AAAF,OAAD,EAAkB;AACxBS,QAAAA,SAAS,CAATA,UAAS,CAATA,GAAAA,MAAAA;AACD;;AAL2B,KAA9Bb;AALF,GAAA;;AAcA,QAAMoB,QAAQ,GAAIC,KAAD,IAAgB;AAC/B,QAAI,CAACrB,KAAK,CAAV,IAAA,EAAiB;AACfA,MAAAA,KAAK,CAALA,IAAAA,GAAAA,IAAAA;AACAA,MAAAA,KAAK,CAALA,OAAAA,GAAgBqB,KAAK,CAALA,MAAAA,CAAaL,aAAa,CAA1ChB,UAA0C,CAA1BqB,CAAhBrB;AACAsB,MAAAA,SAAS,CAATA,OAAAA,CAAkB,MAAM;AACtBtB,QAAAA,KAAK,CAALA,MAAAA,CAAAA,OAAAA,CAAqBtB,KAAK,IACxBA,KAAK,CAALA,WAAAA,CAAkBsB,KAAK,CAAvBtB,KAAAA,EAA+BsB,KAAK,CADtCA,OACEtB,CADFsB;AAGAA,QAAAA,KAAK,CAALA,IAAAA,GAAAA,KAAAA;AAJFsB,OAAAA;AAMD;AAVH,GAAA;;AAaAb,EAAAA,SAAS,CAAC,MAAMT,KAAK,CAArBS,MAAgBT,EAAP,CAATS;AACAxB,EAAAA,OAAO,CAAC,MAAM;AACZsC,IAAAA,QAAQ,CAARA,IAAQ,CAARA;;AAEA,UAAMC,QAAQ,GAAG,MAAM;AACrB,YAAMlB,MAAM,GAAG,MAAMN,KAAK,CAA1B,MAAqBA,EAArB;;AACAsB,MAAAA,SAAS,CAATA,OAAAA,CAAAA,MAAAA;AACAG,MAAAA,UAAU,CAAA,MAAA,EAHW,GAGX,CAAVA,CAHqB,CAAA;AAAvB,KAAA;;AAMAC,IAAAA,MAAM,CAANA,gBAAAA,CAAAA,QAAAA,EAAAA,QAAAA,EAAAA,KAAAA;AACA,WAAO,MAAMA,MAAM,CAANA,mBAAAA,CAAAA,QAAAA,EAAAA,QAAAA,EAAb,KAAaA,CAAb;AAVFzC,GAAO,CAAPA;AAaA,QAAM0C,QAAQ,GAAG5B,OAAO,GAAA,QAAA,GAAxB,QAAA;AACA,SAAA,aACE,aAAA,CAAC,CAAD,CAAA,GAAA,EAAA,QAAA,CAAA,EAAA,EAAA,IAAA,EAAA;AAEE,IAAA,GAAG,EAFL,YAAA;AAGE,IAAA,QAAQ,EAHV,QAAA;AAIE,IAAA,OAAO,EAAEA,OAAO,GAAGC,KAAK,CAAR,IAAA,GAJlB,SAAA;AAKE,IAAA,YAAY,EAAED,OAAO,GAAGC,KAAK,CAAR,IAAA,GALvB,SAAA;AAME,IAAA,KAAK,EAAA,QAAA,CAAA;AACHX,MAAAA,QAAQ,EADL,UAAA;AAEHuC,MAAAA,KAAK,EAFF,MAAA;AAGH/C,MAAAA,MAAM,EAHH,MAAA;AAAA,MAAA,QAAA;AAKHgD,MAAAA,SAAS,EAAEpE,UAAU,GAAA,QAAA,GALlB,QAAA;AAMHqE,MAAAA,SAAS,EAAErE,UAAU,GAAA,QAAA,GANlB,QAAA;AAOHsE,MAAAA,uBAAuB,EAPpB,OAAA;AAQHtC,MAAAA,eAAe,EARZ,eAAA;AASHC,MAAAA,WAAW,EATR,eAAA;AAUHC,MAAAA,SAAS,EAAEjC;AAVR,KAAA,EAWAM,IAAI,CAXJ,KAAA;AANP,GAAA,CAAA,EAmBGgE,KAAK,IAAA,aACJ,aAAA,CAAC,CAAD,CAAA,GAAA,EAAA;AACE,IAAA,GAAG,EADL,UAAA;AAEE,IAAA,KAAK,EAAA,QAAA,CAAA;AACHL,MAAAA,QAAQ,EADL,QAAA;AAEHtC,MAAAA,QAAQ,EAFL,UAAA;AAGH,OAAC5B,UAAU,GAAA,QAAA,GAAX,OAAA,GAHG,MAAA;AAIH,OAACA,UAAU,GAAA,OAAA,GAAX,QAAA,GAAmCuC,KAAK,CAALA,KAAAA,GAJhC,KAAA;AAKHP,MAAAA,eAAe,EALZ,eAAA;AAMHC,MAAAA,WAAW,EANR,eAAA;AAOHC,MAAAA,SAAS,EAAEjC;AAPR,KAAA,EAQAuE,KAAK,CARL,UAAA;AAFP,GAAA,EAAA,aAYE,aAAA,CAAC,aAAD,CAAA,QAAA,EAAA;AAAwB,IAAA,KAAK,EAAEjC;AAA/B,GAAA,EACGhC,IAAI,CAlCf,QAiCQ,CAZF,CApBJ,CADF;AAzGoB,CACtB,CADsB,C","sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport _objectWithoutPropertiesLoose from '@babel/runtime/helpers/esm/objectWithoutPropertiesLoose';\nimport { createContext, memo, forwardRef, useContext, useImperativeHandle, createElement, useState, useEffect, useRef } from 'react';\nimport { Controller, a, config } from '@react-spring/web';\nimport { useMemoOne } from 'use-memo-one';\nimport { frameLoop } from '@react-spring/shared/globals';\nimport { useOnce } from '@react-spring/shared';\n\nconst ParentContext = createContext(null);\n\nfunction getScrollType(horizontal) {\n  return horizontal ? 'scrollLeft' : 'scrollTop';\n}\n\nconst START_TRANSLATE_3D = 'translate3d(0px,0px,0px)';\nconst START_TRANSLATE = 'translate(0px,0px)';\nconst ParallaxLayer = memo(forwardRef((_ref, ref) => {\n  let {\n    horizontal,\n    factor = 1,\n    offset = 0,\n    speed = 0\n  } = _ref,\n      rest = _objectWithoutPropertiesLoose(_ref, [\"horizontal\", \"factor\", \"offset\", \"speed\"]);\n\n  // Our parent controls our height and position.\n  const parent = useContext(ParentContext); // This is how we animate.\n\n  const ctrl = useMemoOne(() => {\n    const targetScroll = Math.floor(offset) * parent.space;\n    const distance = parent.space * offset + targetScroll * speed;\n    return new Controller({\n      space: parent.space * factor,\n      translate: -(parent.current * speed) + distance\n    });\n  }, []); // Create the layer.\n\n  const layer = useMemoOne(() => ({\n    setPosition(height, scrollTop, immediate = false) {\n      const targetScroll = Math.floor(offset) * height;\n      const distance = height * offset + targetScroll * speed;\n      ctrl.start({\n        translate: -(scrollTop * speed) + distance,\n        config: parent.config,\n        immediate\n      });\n    },\n\n    setHeight(height, immediate = false) {\n      ctrl.start({\n        space: height * factor,\n        config: parent.config,\n        immediate\n      });\n    }\n\n  }), []);\n  useImperativeHandle(ref, () => layer); // Register the layer with our parent.\n\n  useOnce(() => {\n    if (parent) {\n      parent.layers.add(layer);\n      parent.update();\n      return () => {\n        parent.layers.delete(layer);\n        parent.update();\n      };\n    }\n  });\n  const translate3d = ctrl.springs.translate.to(horizontal ? x => \"translate3d(\" + x + \"px,0,0)\" : y => \"translate3d(0,\" + y + \"px,0)\");\n  return /*#__PURE__*/createElement(a.div, _extends({}, rest, {\n    style: _extends({\n      position: 'absolute',\n      backgroundSize: 'auto',\n      backgroundRepeat: 'no-repeat',\n      willChange: 'transform',\n      [horizontal ? 'height' : 'width']: '100%',\n      [horizontal ? 'width' : 'height']: ctrl.springs.space,\n      WebkitTransform: translate3d,\n      msTransform: translate3d,\n      transform: translate3d\n    }, rest.style)\n  }));\n}));\nconst Parallax = memo(forwardRef((props, ref) => {\n  const [ready, setReady] = useState(false);\n\n  const {\n    pages,\n    config: config$1 = config.slow,\n    enabled = true,\n    horizontal = false\n  } = props,\n        rest = _objectWithoutPropertiesLoose(props, [\"pages\", \"innerStyle\", \"config\", \"enabled\", \"horizontal\"]);\n\n  const state = useMemoOne(() => ({\n    config: config$1,\n    busy: false,\n    space: 0,\n    current: 0,\n    offset: 0,\n    controller: new Controller({\n      scroll: 0\n    }),\n    layers: new Set(),\n    update: function (_update) {\n      function update() {\n        return _update.apply(this, arguments);\n      }\n\n      update.toString = function () {\n        return _update.toString();\n      };\n\n      return update;\n    }(() => update()),\n    scrollTo: function (_scrollTo) {\n      function scrollTo(_x) {\n        return _scrollTo.apply(this, arguments);\n      }\n\n      scrollTo.toString = function () {\n        return _scrollTo.toString();\n      };\n\n      return scrollTo;\n    }(offset => scrollTo(offset)),\n    stop: () => state.controller.stop()\n  }), []);\n  useEffect(() => {\n    state.config = config$1;\n  }, [config$1]);\n  useImperativeHandle(ref, () => state);\n  const containerRef = useRef();\n  const contentRef = useRef();\n\n  const update = () => {\n    const container = containerRef.current;\n    if (!container) return;\n    const spaceProp = horizontal ? 'clientWidth' : 'clientHeight';\n    state.space = container[spaceProp];\n    const scrollType = getScrollType(horizontal);\n\n    if (enabled) {\n      state.current = container[scrollType];\n    } else {\n      container[scrollType] = state.current = state.offset * state.space;\n    }\n\n    const content = contentRef.current;\n\n    if (content) {\n      const sizeProp = horizontal ? 'width' : 'height';\n      content.style[sizeProp] = state.space * pages + \"px\";\n    }\n\n    state.layers.forEach(layer => {\n      layer.setHeight(state.space, true);\n      layer.setPosition(state.space, state.current, true);\n    });\n  };\n\n  const scrollTo = offset => {\n    const container = containerRef.current;\n    const scrollType = getScrollType(horizontal);\n    state.offset = offset;\n    state.controller.stop().start({\n      scroll: offset * state.space,\n      config: config$1,\n\n      onChange({\n        scroll\n      }) {\n        container[scrollType] = scroll;\n      }\n\n    });\n  };\n\n  const onScroll = event => {\n    if (!state.busy) {\n      state.busy = true;\n      state.current = event.target[getScrollType(horizontal)];\n      frameLoop.onFrame(() => {\n        state.layers.forEach(layer => layer.setPosition(state.space, state.current));\n        state.busy = false;\n      });\n    }\n  };\n\n  useEffect(() => state.update());\n  useOnce(() => {\n    setReady(true);\n\n    const onResize = () => {\n      const update = () => state.update();\n\n      frameLoop.onFrame(update);\n      setTimeout(update, 150); // Some browsers don't fire on maximize!\n    };\n\n    window.addEventListener('resize', onResize, false);\n    return () => window.removeEventListener('resize', onResize, false);\n  });\n  const overflow = enabled ? 'scroll' : 'hidden';\n  return /*#__PURE__*/createElement(a.div, _extends({}, rest, {\n    ref: containerRef,\n    onScroll: onScroll,\n    onWheel: enabled ? state.stop : undefined,\n    onTouchStart: enabled ? state.stop : undefined,\n    style: _extends({\n      position: 'absolute',\n      width: '100%',\n      height: '100%',\n      overflow,\n      overflowY: horizontal ? 'hidden' : overflow,\n      overflowX: horizontal ? overflow : 'hidden',\n      WebkitOverflowScrolling: 'touch',\n      WebkitTransform: START_TRANSLATE,\n      msTransform: START_TRANSLATE,\n      transform: START_TRANSLATE_3D\n    }, rest.style)\n  }), ready && /*#__PURE__*/createElement(a.div, {\n    ref: contentRef,\n    style: _extends({\n      overflow: 'hidden',\n      position: 'absolute',\n      [horizontal ? 'height' : 'width']: '100%',\n      [horizontal ? 'width' : 'height']: state.space * pages,\n      WebkitTransform: START_TRANSLATE,\n      msTransform: START_TRANSLATE,\n      transform: START_TRANSLATE_3D\n    }, props.innerStyle)\n  }, /*#__PURE__*/createElement(ParentContext.Provider, {\n    value: state\n  }, rest.children)));\n}));\n\nexport { Parallax, ParallaxLayer };\n//# sourceMappingURL=index.js.map\n"]},"metadata":{},"sourceType":"module"}