{"ast":null,"code":"import _classCallCheck from\"/Users/jatinkumar/Downloads/BonsaiChat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/jatinkumar/Downloads/BonsaiChat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/Users/jatinkumar/Downloads/BonsaiChat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/jatinkumar/Downloads/BonsaiChat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import _slicedToArray from\"/Users/jatinkumar/Downloads/BonsaiChat/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from'react';import'./App.css';import ChatBot from'react-simple-chatbot';import{ThemeProvider}from'styled-components';import ChatBanner from'./ChatBanner';import InfoIcon from'@material-ui/icons/Info';import{FreeBreakfastOutlined,Info}from'@material-ui/icons';import{Typography}from'@material-ui/core';import styles from'./Chat.css';import{RemoveScrollBar}from'react-remove-scroll-bar';import firebase from'firebase';var COMPANY_NAME=\"Branch\";var userName=\"\";var agentID;var agentMessage='placeholder';var db;function MessageHandler(props){useEffect(function(){db=firebase.firestore();var steps=props.steps;var message=steps.message.value;//Upload this message to the backend\ndb.collection('companies').doc(COMPANY_NAME).collection('agents').doc(agentID).collection(userName).add({message:message,from:'user',created:firebase.firestore.Timestamp.fromDate(new Date())}).then(function(){props.triggerNextStep({trigger:'message'});});},[]);return/*#__PURE__*/React.createElement(\"div\",null);}function Connecting(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),working=_useState2[0],setWorking=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),assignedAgentID=_useState4[0],setAssignedAgentID=_useState4[1];useEffect(function(){db=firebase.firestore();var steps=props.steps;var chatter=steps.name.value;//Assign a random agent to this person\nconsole.log(chatter);userName=chatter;db.collection('companies').doc(COMPANY_NAME).collection('agents').get().then(function(querySnapshot){var agentIDs=[];var agents=[];querySnapshot.forEach(function(doc){// doc.data() is never undefined for query doc snapshots\nconsole.log(doc.id,\" => \",doc.data());agentIDs.push(doc.id);agents.push(doc.data());});//Loop through agents and find the first online\nfor(var i=0;i<agents.length;i++){console.log(agents[i][\"online\"]);console.log(agentIDs[i]);if(agents[i][\"online\"]){//Select this agent and assign them to this person\nsetAssignedAgentID(agentIDs[i]);agentID=agentIDs[i];break;}}props.triggerNextStep({trigger:'7'});db.collection('companies').doc(COMPANY_NAME).collection('agents').doc(agentID).collection(userName).where(\"from\",\"==\",\"agent\").onSnapshot(function(querySnapshot){var messages=[];querySnapshot.docChanges().forEach(function(change){console.log(change.doc.data()[\"message\"]);agentMessage=change.doc.data()[\"message\"];setTimeout(function(){console.log(agentMessage);props.triggerNextStep({trigger:'handleAgentMessage'});},2000);});});//console.log(\"FOUND AGENT: \" + assignedAgentID)\n}).catch(function(error){console.log(\"Error getting documents: \",error);});//setInterval(function () {console.log(\"checking...\")},2000)\n},[]);setTimeout(function(){console.log(agentID);},3000);return/*#__PURE__*/React.createElement(\"div\",null);}var steps=[{id:'1',message:\"Welcome to \"+COMPANY_NAME+\"!\",trigger:'2'},{id:'2',message:'Would you like to look at our support articles or speak with an agent?',trigger:'3'},{id:'3',options:[{value:'Articles',label:'Articles',trigger:'4'},{value:'Agent',label:'Agent',trigger:'4'}]},{id:'4',message:'Please enter your full name.',trigger:'name'},{id:'name',user:true,trigger:'6'},{id:'6',component:/*#__PURE__*/React.createElement(Connecting,null),waitAction:true},{id:'7',message:'You are now connected with an agent.',trigger:'message'},{id:'message',user:true,trigger:'messageHandler'},{id:'messageHandler',component:/*#__PURE__*/React.createElement(MessageHandler,null),waitAction:true},{id:'handleAgentMessage',component:/*#__PURE__*/React.createElement(\"div\",null,agentMessage),asMessage:true,end:true}];var theme={background:'#f5f8fb',fontFamily:'Helvetica Neue',headerBgColor:'#000000',headerFontColor:'#fff',headerFontSize:'15px',botBubbleColor:'#EF6C00',botFontColor:'#fff',userBubbleColor:'#fff',userFontColor:'#4a4a4a'};var ChatSection=/*#__PURE__*/function(_React$Component){_inherits(ChatSection,_React$Component);var _super=_createSuper(ChatSection);function ChatSection(){_classCallCheck(this,ChatSection);return _super.apply(this,arguments);}_createClass(ChatSection,[{key:\"render\",value:function render(){return/*#__PURE__*/React.createElement(ThemeProvider,{theme:theme},/*#__PURE__*/React.createElement(ChatBot,{hideHeader:true,steps:steps,customStyle:{backgroundColor:'transparent','boxShadow':'none'},contentStyle:{height:this.props.height}}));}}]);return ChatSection;}(React.Component);export{ChatSection as default};","map":{"version":3,"sources":["/Users/jatinkumar/Downloads/BonsaiChat/src/ChatSection.js"],"names":["React","useEffect","useState","ChatBot","ThemeProvider","ChatBanner","InfoIcon","FreeBreakfastOutlined","Info","Typography","styles","RemoveScrollBar","firebase","COMPANY_NAME","userName","agentID","agentMessage","db","MessageHandler","props","firestore","steps","message","value","collection","doc","add","from","created","Timestamp","fromDate","Date","then","triggerNextStep","trigger","Connecting","working","setWorking","assignedAgentID","setAssignedAgentID","chatter","name","console","log","get","querySnapshot","agentIDs","agents","forEach","id","data","push","i","length","where","onSnapshot","messages","docChanges","change","setTimeout","catch","error","options","label","user","component","waitAction","asMessage","end","theme","background","fontFamily","headerBgColor","headerFontColor","headerFontSize","botBubbleColor","botFontColor","userBubbleColor","userFontColor","ChatSection","backgroundColor","height","Component"],"mappings":"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","sourcesContent":["import React, {useEffect, useState}from 'react';\nimport './App.css';\nimport ChatBot from 'react-simple-chatbot';\nimport { ThemeProvider } from 'styled-components';\nimport ChatBanner from './ChatBanner';\nimport InfoIcon from '@material-ui/icons/Info';\nimport { FreeBreakfastOutlined, Info } from '@material-ui/icons';\nimport { Typography } from '@material-ui/core';\nimport styles from './Chat.css'; \nimport {RemoveScrollBar} from 'react-remove-scroll-bar';\nimport firebase from 'firebase'\n\nconst COMPANY_NAME = \"Branch\";\n\nvar userName = \"\";\n\nvar agentID;\n\nvar agentMessage = 'placeholder';\n\nvar db;\n\nfunction MessageHandler (props) {\n  useEffect (() => {\n    db = firebase.firestore();\n    const {steps} = props;\n    const message = steps.message.value;\n    //Upload this message to the backend\n    db.collection('companies').doc(COMPANY_NAME).collection('agents').doc(agentID).collection(userName).add({\n      message: message,\n      from: 'user',\n      created: firebase.firestore.Timestamp.fromDate(new Date())\n    }).then(() => {\n      props.triggerNextStep({trigger: 'message'});\n    })\n  }, [])\n  return (<div></div>);\n}\n\nfunction Connecting (props) {\n\n  const [working, setWorking] = useState(false);\n\n  const [assignedAgentID, setAssignedAgentID] = useState('');\n\n  useEffect(() => {\n    db = firebase.firestore();\n    const { steps } = props;\n    const chatter = steps.name.value;\n    //Assign a random agent to this person\n    console.log(chatter)\n    userName = chatter;\n    db.collection('companies').doc(COMPANY_NAME).collection('agents').get()\n    .then(function(querySnapshot) {\n        var agentIDs = [];\n        var agents = [];\n        querySnapshot.forEach(function(doc) {\n            // doc.data() is never undefined for query doc snapshots\n            console.log(doc.id, \" => \", doc.data());\n            agentIDs.push(doc.id);\n            agents.push(doc.data());\n        });\n        \n        //Loop through agents and find the first online\n        for (var i = 0; i < agents.length; i++) {\n          console.log(agents[i][\"online\"])\n          console.log(agentIDs[i])\n          if (agents[i][\"online\"]) {\n            //Select this agent and assign them to this person\n            setAssignedAgentID(agentIDs[i]);\n            agentID = agentIDs[i];\n            break;\n          }\n        }\n\n        props.triggerNextStep({trigger: '7'});\n\n        db.collection('companies').doc(COMPANY_NAME).collection('agents').doc(agentID).collection(userName).where(\"from\", \"==\", \"agent\")\n        .onSnapshot(function(querySnapshot) {\n            var messages = [];\n            querySnapshot.docChanges().forEach(function(change) {\n              console.log(change.doc.data()[\"message\"]);\n              agentMessage = change.doc.data()[\"message\"];\n              setTimeout(function() {\n                console.log(agentMessage)\n                props.triggerNextStep({trigger: 'handleAgentMessage'})\n              }, 2000)\n            });\n        });\n        //console.log(\"FOUND AGENT: \" + assignedAgentID)\n\n    })\n    .catch(function(error) {\n        console.log(\"Error getting documents: \", error);\n    });\n\n    //setInterval(function () {console.log(\"checking...\")},2000)\n    \n  }, []); \n\n  setTimeout(function () {\n    console.log(agentID)\n  }, 3000)\n\n  return (\n    <div></div>\n  );\n}\n\n\nconst steps = [\n  {\n    id: '1',\n    message: \"Welcome to \" + COMPANY_NAME + \"!\",\n    trigger: '2',\n  },\n  {\n    id: '2',\n    message: 'Would you like to look at our support articles or speak with an agent?',\n    trigger: '3'\n  },\n  {\n    id: '3',\n    options: [\n      { value: 'Articles', label: 'Articles', trigger: '4' },\n      { value: 'Agent', label: 'Agent', trigger: '4' },\n    ],\n  },\n  {\n    id: '4',\n    message: 'Please enter your full name.',\n    trigger: 'name'\n  },\n  {\n    id: 'name',\n    user: true,\n    trigger: '6',\n  },\n  {\n    id: '6',\n    component: <Connecting />,\n    waitAction: true,\n  },\n  {\n    id: '7',\n    message: 'You are now connected with an agent.',\n    trigger: 'message'\n  },\n  {\n    id: 'message',\n    user: true,\n    trigger: 'messageHandler'\n  },\n  {\n    id: 'messageHandler',\n    component: <MessageHandler/>,\n    waitAction: true\n  },\n  {\n    id: 'handleAgentMessage',\n    component: (\n    <div>{agentMessage}</div>\n    ),\n    asMessage: true,\n    end: true\n  }\n]\n\nconst theme = {\n    background: '#f5f8fb',\n    fontFamily: 'Helvetica Neue',\n    headerBgColor: '#000000',\n    headerFontColor: '#fff',\n    headerFontSize: '15px',\n    botBubbleColor: '#EF6C00',\n    botFontColor: '#fff',\n    userBubbleColor: '#fff',\n    userFontColor: '#4a4a4a',\n  };\n\nexport default class ChatSection extends React.Component{\n    render(){\n        return(\n            <ThemeProvider theme={theme}>\n                <ChatBot hideHeader={true} steps={steps} customStyle={{backgroundColor:'transparent', 'boxShadow': 'none'}} contentStyle={{height: this.props.height}} />\n            </ThemeProvider>\n        )\n    }\n}"]},"metadata":{},"sourceType":"module"}